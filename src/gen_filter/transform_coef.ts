import {writeFileSync}  from "fs";


const scaleCoefficients = (coeffs: number[], scaleBits: number = 11): number[] => {
    const scaleFactor = 1 << scaleBits; // 2^scaleBits
    return coeffs.map(c => Math.round(c * scaleFactor));
  };
  
  // Ejemplo de uso
  const originalCoeffs = [
    0.000000000000000000,
    0.000007089254541241,
    0.000040982153450201,
    0.000114844201775314,
    0.000229282466569670,
    0.000366449499768783,
    0.000485554151555692,
    0.000521739991755640,
    0.000390575038207813,
    0.000000000000000000,
    -0.000729631515130406,
    -0.001838720477456150,
    -0.003298397915155672,
    -0.004983026030425332,
    -0.006652247065974609,
    -0.007949546407311679,
    -0.008422577180419980,
    -0.007567170301013336,
    -0.004892489896200722,
    0.000000000000000002,
    0.007335206643526098,
    0.017094609576550658,
    0.028971907681722187,
    0.042365331159356215,
    0.056412667295446355,
    0.070068200301094521,
    0.082213446391851713,
    0.091787166614097526,
    0.097915951452103259,
    0.100025605831429137,
    0.097915951452103259,
    0.091787166614097526,
    0.082213446391851713,
    0.070068200301094508,
    0.056412667295446355,
    0.042365331159356229,
    0.028971907681722201,
    0.017094609576550655,
    0.007335206643526100,
    0.000000000000000002,
    -0.004892489896200725,
    -0.007567170301013340,
    -0.008422577180419980,
    -0.007949546407311688,
    -0.006652247065974618,
    -0.004983026030425335,
    -0.003298397915155677,
    -0.001838720477456152,
    -0.000729631515130406,
    0.000000000000000000,
    0.000390575038207813,
    0.000521739991755639,
    0.000485554151555692,
    0.000366449499768783,
    0.000229282466569670,
    0.000114844201775314,
    0.000040982153450201,
    0.000007089254541241,
    0.000000000000000000
  ];
  
  const scaled = scaleCoefficients(originalCoeffs);
  
// 🖨️ Imprimir para VHDL
let buffer : string = 'constant rom : integer_array := (';
console.log("const h : coef_array_t := (");
scaled.forEach((v, i) => {
  const comma = i < scaled.length - 1 ? ',' : '';
  //console.log(`    to_signed(${v}, DATA_W)${comma}`);
  console.log(`    ${v}${comma}`);
  //buffer += `to_signed(${v}, DATA_W)${comma}\n`;
  buffer += `${v}${comma}\n`;
});
console.log(");");
console.log('Tamaño del array: '+scaled.length);

buffer+= ');';
writeFileSync('./coef.vhd',buffer);